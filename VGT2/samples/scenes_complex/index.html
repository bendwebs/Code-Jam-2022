<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>

        <script type="text/javascript" src="boxes.js"></script>
        <script type="text/javascript" src="matter.js"></script>
        <script src="https://unpkg.com/kaboom/dist/kaboom.js"></script>

        <script>
            // initialize context
            kaboom( {
                scale: 1,
                width: 1500,
                height: 600
            })
            
            scene("start", () => {
                
                add([
                    text("Click to Start"),
                    pos(width()/3, 600/2),
                ])

                onClick(() => go("game"))
            })

            scene("game", () => {
                // console.log('game')
            
                let engine = Matter.Engine.create();
                let render = Matter.Render.create({
                    element: document.body,
                    engine: engine
                });

                let ground = Matter.Bodies.rectangle(20,600,250,160,{isStatic: true});
                let mid = Matter.Bodies.rectangle(200,350,80,40,{isStatic: true});
                let mountain = Matter.Bodies.rectangle(450,600,75,950,{isStatic: true});
                let goal = Matter.Bodies.rectangle(750,600,100,50,{isStatic: true});
                
                // let test = Matter.Bodies.rectangle(320,200,150,40,{isStatic: true});
                let test = Matter.Bodies.circle(320,200,27,{isStatic: true,restitution: .8, speed: 20, friction: -2});
            
                // add misc options
                let canvas = Matter.Mouse.create(render.canvas);

                // adds mouse constraints
                let mouseConstraint = Matter.MouseConstraint.create(engine, {
                    mouse: canvas,
                    constraint: {
                        render: {
                            visible: false,
                            wireframe: false
                        }
                    }
                });

                // generates X number of blocks and adds then to the world
                // player only controls the first object generated
                let blocks = [];
                let numOfSqBlocks = 1;

                for (let i = 0; i < numOfSqBlocks;i++) {
                    let block = new Box();
                    blocks.push(block);
                    
                }

                function addBlock(blocks) {
                    blocks.forEach(element => {
                        Matter.World.add(engine.world, [element]);
                        
                    });
                }

                render.mouse = canvas;

                // create base world + add mouse
                Matter.World.add(engine.world, [
                    test,mouseConstraint, ground, mid, mountain, goal
                ]);

                // add boxes
                addBlock(blocks);

                Matter.Runner.run(engine);
                Matter.Render.run(render);




                // movement event listeners
                document.body.addEventListener("keydown",function(){
                    var code=76; // 75 is keycode of 'k'
                    if(event.keyCode==code)
                    {
                        currentPosition = blocks[0].position;
                        if (currentPosition) {
                            blocks[0].position = {
                                x: currentPosition.x +1,
                                y: currentPosition.y +1
                            }
                        }
                    }
                });

                document.body.addEventListener("keydown",function(){
                    var code=75; // 75 is keycode of 'k'
                    if(event.keyCode==code)
                    {
                        currentPosition = blocks[0].position;
                        if (currentPosition) {
                            blocks[0].position = {
                                x: currentPosition.x -1,
                                y: currentPosition.y -1
                            }
                        }
                    }
                });

                document.body.addEventListener("keydown",function(){
                    var code=72; // 75 is keycode of 'h'
                    if(event.keyCode==code)
                    {
                        angle = blocks[0].angle
                        if (angle) {
                            blocks[0].angle = angle + .04;
                        }
                    }
                });










            })

            scene("end", () => {
                scored = 10;
                add([
                    text("Game Over"),
                    pos(24, 24),
                    { value: 1 },
                ])

                const score = add([
                    text("Score: "+scored),
                    pos(24, 94),
                    { value: 0 },
                ])
            })

            
            go("start")


        </script>

    </body>
</html>